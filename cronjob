#!/bin/bash
export CRAWL_CONF=$HOME/prj/hpssic/dev/hpss-dev01.crawl.cfg
export PYTHONPATH=$HOME/prj/hpssic/dev
export CRONOUT=/tmp/cronjob.$$.out

/bin/echo "--------------------------------------------" > $CRONOUT

/bin/date "+%Y.%m%d %H:%M:%S" >> $CRONOUT
cd $HOME/prj/hpssic/dev
/usr/bin/nosetests -c hpssic/test/nosecron.cfg test >> $CRONOUT 2>&1
STATUS=$?
/bin/date "+%Y.%m%d %H:%M:%S" >> $CRONOUT

if [[ "$STATUS" == "0" ]]; then
    SUMMARY=$(grep "^Ran" $CRONOUT)
else
    SUMMARY=$(grep "^FAILED" $CRONOUT)
fi

SUBJECT="HPSSIC tests: $SUMMARY"
/bin/mail -s "$SUBJECT" tbarron@ornl.gov tusculum@gmail.com < $CRONOUT
/bin/rm $CRONOUT
